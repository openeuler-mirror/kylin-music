From 9df3962f678c098f307454dcfe86863a816a6a49 Mon Sep 17 00:00:00 2001
From: pei-jiankang <peijiankang@kylinos.cn>
Date: Thu, 7 Apr 2022 13:33:57 +0800
Subject: [PATCH] modify version is error

---
 menumodule.cpp                    |  22 ++++
 translations/kylin-music_zh_CN.ts | 210 +++++++++++++++---------------
 2 files changed, 127 insertions(+), 105 deletions(-)

diff --git a/menumodule.cpp b/menumodule.cpp
index 806c98d..40472c3 100644
--- a/menumodule.cpp
+++ b/menumodule.cpp
@@ -237,6 +237,28 @@ QVBoxLayout* menuModule::initBody(){
 //    bodyAppName->setText(tr(appShowingName.toLocal8Bit()));
     bodyAppName->setText(tr("kylin music"));
     bodyAppName->setStyleSheet("font-size:18px;");
+    FILE *pp = NULL;
+    char *line = NULL;
+    char *q = NULL;
+    size_t len = 0;
+    ssize_t read;
+
+    pp = popen("rpm -qa kylin-music", "r");
+    if(pp) { while((read = getline(&line, &len, pp)) != -1){
+        q = strrchr(line, '\n');
+        *q = '\0';
+        QString content = line;
+        QStringList list = content.split("-");
+        if (list.size() >= 3)
+	    appVersion = list.at(2);
+        }
+    }
+    if(line){
+        free(line);
+	line = NULL;
+    }
+    pclose(pp);
+
     QLabel* bodyAppVersion = new QLabel();
     bodyAppVersion->setFixedHeight(24);
     bodyAppVersion->setText(tr("Version: ") + appVersion);
diff --git a/translations/kylin-music_zh_CN.ts b/translations/kylin-music_zh_CN.ts
index e45eb8f..8e8a3c0 100644
--- a/translations/kylin-music_zh_CN.ts
+++ b/translations/kylin-music_zh_CN.ts
@@ -121,40 +121,40 @@
         <translation type="vanished">播放/暂停</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="109"/>
+        <location filename="../mainwid.cpp" line="114"/>
         <source>Kylin music</source>
         <translation>麒麟音乐</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="594"/>
+        <location filename="../mainwid.cpp" line="597"/>
         <source>maximize</source>
         <translation>最大化</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="607"/>
+        <location filename="../mainwid.cpp" line="610"/>
         <source>reduction</source>
         <translation>还原</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="854"/>
+        <location filename="../mainwid.cpp" line="857"/>
         <source>rename</source>
         <translation>重命名</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="856"/>
+        <location filename="../mainwid.cpp" line="859"/>
         <source>Delete the playlist</source>
         <translation>删除歌单</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="892"/>
-        <location filename="../mainwid.cpp" line="975"/>
-        <location filename="../mainwid.cpp" line="988"/>
-        <location filename="../mainwid.cpp" line="1003"/>
+        <location filename="../mainwid.cpp" line="895"/>
+        <location filename="../mainwid.cpp" line="978"/>
+        <location filename="../mainwid.cpp" line="991"/>
+        <location filename="../mainwid.cpp" line="1006"/>
         <source>play</source>
         <translation>播放</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="893"/>
+        <location filename="../mainwid.cpp" line="896"/>
         <source>The following piece</source>
         <translation>下一首</translation>
     </message>
@@ -163,69 +163,69 @@
         <translation type="vanished">添加到我喜欢</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="894"/>
+        <location filename="../mainwid.cpp" line="897"/>
         <source>Remove from the song list</source>
         <translation>从歌曲列表中删除</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="898"/>
+        <location filename="../mainwid.cpp" line="901"/>
         <source>Add to playlist</source>
         <translation>添加到歌单</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="895"/>
+        <location filename="../mainwid.cpp" line="898"/>
         <source>Song information</source>
         <translation>歌曲信息</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="969"/>
+        <location filename="../mainwid.cpp" line="972"/>
         <source>pause</source>
         <translation>暂停</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="1593"/>
+        <location filename="../mainwid.cpp" line="1596"/>
         <source>The song name:</source>
         <translation>歌曲名称:</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="1594"/>
+        <location filename="../mainwid.cpp" line="1597"/>
         <source>singer:</source>
         <translation>歌曲歌手:</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="1595"/>
+        <location filename="../mainwid.cpp" line="1598"/>
         <source>album:</source>
         <translation>歌曲专辑:</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="1596"/>
+        <location filename="../mainwid.cpp" line="1599"/>
         <source>The file type:</source>
         <translation>文件类型:</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="1597"/>
+        <location filename="../mainwid.cpp" line="1600"/>
         <source>The file size:</source>
         <translation>文件大小:</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="1598"/>
+        <location filename="../mainwid.cpp" line="1601"/>
         <source>File length:</source>
         <translation>文件时长:</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="1599"/>
+        <location filename="../mainwid.cpp" line="1602"/>
         <source>File location:</source>
         <translation>文件位置:</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="3660"/>
-        <location filename="../mainwid.cpp" line="3692"/>
+        <location filename="../mainwid.cpp" line="3663"/>
+        <location filename="../mainwid.cpp" line="3695"/>
         <source>警告</source>
         <translation type="unfinished"></translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="3660"/>
-        <location filename="../mainwid.cpp" line="3692"/>
+        <location filename="../mainwid.cpp" line="3663"/>
+        <location filename="../mainwid.cpp" line="3695"/>
         <source>暂无法打开文件，请检查路径和文件名称</source>
         <translation type="unfinished"></translation>
     </message>
@@ -234,7 +234,7 @@
         <translation type="vanished">麒麟音乐</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="155"/>
+        <location filename="../mainwid.cpp" line="160"/>
         <source>volume</source>
         <translation>音量调节</translation>
     </message>
@@ -263,52 +263,52 @@
         <translation type="vanished">默认歌单无法重命名！</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="1080"/>
-        <location filename="../mainwid.cpp" line="1203"/>
-        <location filename="../mainwid.cpp" line="1224"/>
-        <location filename="../mainwid.cpp" line="1258"/>
-        <location filename="../mainwid.cpp" line="1285"/>
-        <location filename="../mainwid.cpp" line="1313"/>
-        <location filename="../mainwid.cpp" line="1345"/>
-        <location filename="../mainwid.cpp" line="1378"/>
-        <location filename="../mainwid.cpp" line="1399"/>
-        <location filename="../mainwid.cpp" line="1574"/>
-        <location filename="../mainwid.cpp" line="1846"/>
-        <location filename="../mainwid.cpp" line="1931"/>
-        <location filename="../mainwid.cpp" line="2177"/>
-        <location filename="../mainwid.cpp" line="2223"/>
-        <location filename="../mainwid.cpp" line="2306"/>
-        <location filename="../mainwid.cpp" line="2348"/>
-        <location filename="../mainwid.cpp" line="3403"/>
-        <location filename="../mainwid.cpp" line="3441"/>
-        <location filename="../mainwid.cpp" line="3744"/>
-        <location filename="../mainwid.cpp" line="3778"/>
-        <location filename="../mainwid.cpp" line="3921"/>
+        <location filename="../mainwid.cpp" line="1083"/>
+        <location filename="../mainwid.cpp" line="1206"/>
+        <location filename="../mainwid.cpp" line="1227"/>
+        <location filename="../mainwid.cpp" line="1261"/>
+        <location filename="../mainwid.cpp" line="1288"/>
+        <location filename="../mainwid.cpp" line="1316"/>
+        <location filename="../mainwid.cpp" line="1348"/>
+        <location filename="../mainwid.cpp" line="1381"/>
+        <location filename="../mainwid.cpp" line="1402"/>
+        <location filename="../mainwid.cpp" line="1577"/>
+        <location filename="../mainwid.cpp" line="1849"/>
+        <location filename="../mainwid.cpp" line="1934"/>
+        <location filename="../mainwid.cpp" line="2180"/>
+        <location filename="../mainwid.cpp" line="2226"/>
+        <location filename="../mainwid.cpp" line="2309"/>
+        <location filename="../mainwid.cpp" line="2351"/>
+        <location filename="../mainwid.cpp" line="3406"/>
+        <location filename="../mainwid.cpp" line="3444"/>
+        <location filename="../mainwid.cpp" line="3747"/>
+        <location filename="../mainwid.cpp" line="3781"/>
+        <location filename="../mainwid.cpp" line="3934"/>
         <source>A total of</source>
         <translation>共</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="1080"/>
-        <location filename="../mainwid.cpp" line="1203"/>
-        <location filename="../mainwid.cpp" line="1224"/>
-        <location filename="../mainwid.cpp" line="1258"/>
-        <location filename="../mainwid.cpp" line="1285"/>
-        <location filename="../mainwid.cpp" line="1313"/>
-        <location filename="../mainwid.cpp" line="1345"/>
-        <location filename="../mainwid.cpp" line="1378"/>
-        <location filename="../mainwid.cpp" line="1399"/>
-        <location filename="../mainwid.cpp" line="1574"/>
-        <location filename="../mainwid.cpp" line="1846"/>
-        <location filename="../mainwid.cpp" line="1931"/>
-        <location filename="../mainwid.cpp" line="2177"/>
-        <location filename="../mainwid.cpp" line="2223"/>
-        <location filename="../mainwid.cpp" line="2306"/>
-        <location filename="../mainwid.cpp" line="2348"/>
-        <location filename="../mainwid.cpp" line="3403"/>
-        <location filename="../mainwid.cpp" line="3441"/>
-        <location filename="../mainwid.cpp" line="3744"/>
-        <location filename="../mainwid.cpp" line="3778"/>
-        <location filename="../mainwid.cpp" line="3921"/>
+        <location filename="../mainwid.cpp" line="1083"/>
+        <location filename="../mainwid.cpp" line="1206"/>
+        <location filename="../mainwid.cpp" line="1227"/>
+        <location filename="../mainwid.cpp" line="1261"/>
+        <location filename="../mainwid.cpp" line="1288"/>
+        <location filename="../mainwid.cpp" line="1316"/>
+        <location filename="../mainwid.cpp" line="1348"/>
+        <location filename="../mainwid.cpp" line="1381"/>
+        <location filename="../mainwid.cpp" line="1402"/>
+        <location filename="../mainwid.cpp" line="1577"/>
+        <location filename="../mainwid.cpp" line="1849"/>
+        <location filename="../mainwid.cpp" line="1934"/>
+        <location filename="../mainwid.cpp" line="2180"/>
+        <location filename="../mainwid.cpp" line="2226"/>
+        <location filename="../mainwid.cpp" line="2309"/>
+        <location filename="../mainwid.cpp" line="2351"/>
+        <location filename="../mainwid.cpp" line="3406"/>
+        <location filename="../mainwid.cpp" line="3444"/>
+        <location filename="../mainwid.cpp" line="3747"/>
+        <location filename="../mainwid.cpp" line="3781"/>
+        <location filename="../mainwid.cpp" line="3934"/>
         <source>The first</source>
         <translation>首</translation>
     </message>
@@ -341,49 +341,49 @@
         <translation type="vanished">文件位置</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="2032"/>
-        <location filename="../mainwid.cpp" line="2418"/>
-        <location filename="../mainwid.cpp" line="2474"/>
+        <location filename="../mainwid.cpp" line="2035"/>
+        <location filename="../mainwid.cpp" line="2421"/>
+        <location filename="../mainwid.cpp" line="2477"/>
         <source>00:00</source>
         <translation>00:00</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="468"/>
-        <location filename="../mainwid.cpp" line="473"/>
-        <location filename="../mainwid.cpp" line="2790"/>
-        <location filename="../mainwid.cpp" line="2795"/>
-        <location filename="../mainwid.cpp" line="2866"/>
-        <location filename="../mainwid.cpp" line="2937"/>
+        <location filename="../mainwid.cpp" line="471"/>
+        <location filename="../mainwid.cpp" line="476"/>
+        <location filename="../mainwid.cpp" line="2793"/>
+        <location filename="../mainwid.cpp" line="2798"/>
+        <location filename="../mainwid.cpp" line="2869"/>
+        <location filename="../mainwid.cpp" line="2940"/>
         <source> A list of circulation </source>
         <translation>列表循环</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="484"/>
-        <location filename="../mainwid.cpp" line="489"/>
-        <location filename="../mainwid.cpp" line="2808"/>
-        <location filename="../mainwid.cpp" line="2813"/>
-        <location filename="../mainwid.cpp" line="2882"/>
-        <location filename="../mainwid.cpp" line="2953"/>
+        <location filename="../mainwid.cpp" line="487"/>
+        <location filename="../mainwid.cpp" line="492"/>
+        <location filename="../mainwid.cpp" line="2811"/>
+        <location filename="../mainwid.cpp" line="2816"/>
+        <location filename="../mainwid.cpp" line="2885"/>
+        <location filename="../mainwid.cpp" line="2956"/>
         <source> Random broadcast </source>
         <translation>随机播放</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="436"/>
-        <location filename="../mainwid.cpp" line="441"/>
-        <location filename="../mainwid.cpp" line="2826"/>
-        <location filename="../mainwid.cpp" line="2831"/>
-        <location filename="../mainwid.cpp" line="2898"/>
-        <location filename="../mainwid.cpp" line="2969"/>
+        <location filename="../mainwid.cpp" line="439"/>
+        <location filename="../mainwid.cpp" line="444"/>
+        <location filename="../mainwid.cpp" line="2829"/>
+        <location filename="../mainwid.cpp" line="2834"/>
+        <location filename="../mainwid.cpp" line="2901"/>
+        <location filename="../mainwid.cpp" line="2972"/>
         <source> Order of play </source>
         <translation>顺序播放</translation>
     </message>
     <message>
-        <location filename="../mainwid.cpp" line="452"/>
-        <location filename="../mainwid.cpp" line="457"/>
-        <location filename="../mainwid.cpp" line="2772"/>
-        <location filename="../mainwid.cpp" line="2777"/>
-        <location filename="../mainwid.cpp" line="2850"/>
-        <location filename="../mainwid.cpp" line="2921"/>
+        <location filename="../mainwid.cpp" line="455"/>
+        <location filename="../mainwid.cpp" line="460"/>
+        <location filename="../mainwid.cpp" line="2775"/>
+        <location filename="../mainwid.cpp" line="2780"/>
+        <location filename="../mainwid.cpp" line="2853"/>
+        <location filename="../mainwid.cpp" line="2924"/>
         <source> Single cycle </source>
         <translation>单曲循环</translation>
     </message>
@@ -796,8 +796,8 @@
         <translation>麒麟音乐</translation>
     </message>
     <message>
-        <location filename="../menumodule.cpp" line="291"/>
-        <location filename="../menumodule.cpp" line="300"/>
+        <location filename="../menumodule.cpp" line="318"/>
+        <location filename="../menumodule.cpp" line="327"/>
         <source>Service &amp; Support: </source>
         <translation>服务与支持：</translation>
     </message>
@@ -821,7 +821,7 @@
         <translation>深色主题</translation>
     </message>
     <message>
-        <location filename="../menumodule.cpp" line="237"/>
+        <location filename="../menumodule.cpp" line="264"/>
         <source>Version: </source>
         <translation>版本号：</translation>
     </message>
@@ -830,8 +830,8 @@
         <translation type="vanished">开发者：support@kylinos.cn</translation>
     </message>
     <message>
-        <location filename="../menumodule.cpp" line="212"/>
-        <location filename="../menumodule.cpp" line="233"/>
+        <location filename="../menumodule.cpp" line="217"/>
+        <location filename="../menumodule.cpp" line="238"/>
         <source>kylin music</source>
         <translation>麒麟音乐</translation>
     </message>
@@ -844,23 +844,23 @@
         <translation>麒麟音乐</translation>
     </message>
     <message>
-        <location filename="../miniwidget.cpp" line="52"/>
-        <location filename="../miniwidget.cpp" line="53"/>
+        <location filename="../miniwidget.cpp" line="57"/>
+        <location filename="../miniwidget.cpp" line="58"/>
         <source>列表循环</source>
         <translation type="unfinished"></translation>
     </message>
     <message>
-        <location filename="../miniwidget.cpp" line="54"/>
+        <location filename="../miniwidget.cpp" line="59"/>
         <source>随机播放</source>
         <translation type="unfinished"></translation>
     </message>
     <message>
-        <location filename="../miniwidget.cpp" line="55"/>
+        <location filename="../miniwidget.cpp" line="60"/>
         <source>顺序播放</source>
         <translation type="unfinished"></translation>
     </message>
     <message>
-        <location filename="../miniwidget.cpp" line="56"/>
+        <location filename="../miniwidget.cpp" line="61"/>
         <source>单曲循环</source>
         <translation type="unfinished"></translation>
     </message>
-- 
2.33.0

